SWITCH DITRIB

en
conf t
interface <port>
 switchport mode trunk
 switchport trunk allowed vlan 10-210
end
write memory


SWITCH CORE

conf t

ip routing

vlan 10
   name RH
exit

vlan 20
   name Comptabilite
exit

vlan 30
   name Design
exit

vlan 40
   name Logistique
exit

vlan 50
   name Imprimantes
exit

vlan 60
   name Direction
exit

vlan 70
   name DSI
exit

vlan 80
   name R&D
exit

vlan 90
   name Dev
exit

vlan 100
   name Data
exit

vlan 110
   name Conception
exit

vlan 120
   name Invites_WiFi
exit

vlan 130
   name Controle_Acces
exit

vlan 140
   name Securite_Incendie
exit

vlan 150
   name Systeme_Audio
exit

vlan 160
   name Gestion_Batiment
exit

vlan 170
   name Vide1
exit

vlan 180
   name Vide2
exit

vlan 190
   name Vide3
exit

vlan 200
   name Vide4
exit

vlan 210
   name Vide5
exit


interface vlan 10
   ip address 10.0.1.1/23
exit

interface vlan 20
   ip address 10.0.3.1/23
exit

interface vlan 30
   ip address 10.0.5.1/23
exit

interface vlan 40
   ip address 10.0.7.1/23
exit

interface vlan 50
   ip address 10.0.9.1/23
exit

interface vlan 60
   ip address 10.0.11.1/23
exit

interface vlan 70
   ip address 10.0.13.1/23
exit

interface vlan 80
   ip address 10.0.15.1/23
exit

interface vlan 90
   ip address 10.0.17.1/23
exit

interface vlan 100
   ip address 10.0.19.1/23
exit

interface vlan 110
   ip address 10.0.21.1/23
exit

interface vlan 120
   ip address 10.0.23.1/23
exit

interface vlan 130
   ip address 10.0.25.1/25
exit

interface vlan 140
   ip address 10.0.26.1/22
exit

interface vlan 150
   ip address 10.0.30.1/27
exit

interface vlan 160
   ip address 10.0.31.1/28
exit

interface vlan 170
   ip address 10.0.32.1/23
exit

interface vlan 180
   ip address 10.0.34.1/23
exit

interface vlan 190
   ip address 10.0.36.1/23
exit

interface vlan 200
   ip address 10.0.38.1/23
exit

interface vlan 210
   ip address 10.0.40.1/23
exit

interface 1/1/1
   switchport mode trunk
   vlan trunk allowed 10-210
   no shutdown
exit

interface 1/1/2
   switchport mode trunk
   vlan trunk allowed 10-210
   no shutdown
exit

interface 1/1/3
   switchport mode trunk
   vlan trunk allowed 10-210
   no shutdown
exit

router ospf 1
   router-id 1.1.1.1                 
   network 10.0.0.0 0.255.255.255 area 0
exit

do write memory



script routeur



script acl

conf t
# VLAN 1: RH (10.0.1.0/23)
ip access-list extended ACL_VLAN_RH
   permit tcp 10.0.1.0 0.0.1.255 any eq 80
   permit tcp 10.0.1.0 0.0.1.255 any eq 443
   permit udp 10.0.1.0 0.0.1.255 any eq 53
   permit tcp 10.0.1.0 0.0.1.255 10.0.9.0 0.0.1.255 eq 445
   permit tcp 10.0.1.0 0.0.1.255 10.0.9.0 0.0.1.255 eq 631
   permit ip 10.0.1.0 0.0.1.255 10.0.9.0 0.0.1.255
   deny ip any any
exit
interface vlan 10
   ip access-group ACL_VLAN_RH in
exit

# VLAN 2: Comptabilité (10.0.3.0/23)
ip access-list extended ACL_VLAN_COMPTABILITE
   permit tcp 10.0.3.0 0.0.1.255 any eq 80
   permit tcp 10.0.3.0 0.0.1.255 any eq 443
   permit udp 10.0.3.0 0.0.1.255 any eq 53
   permit ip 10.0.3.0 0.0.1.255 10.0.9.0 0.0.1.255
   deny ip any any
exit
interface vlan 20
   ip access-group ACL_VLAN_COMPTABILITE in
exit

# VLAN 3: Design (10.0.5.0/23)
ip access-list extended ACL_VLAN_DESIGN
   permit tcp 10.0.5.0 0.0.1.255 any eq 80
   permit tcp 10.0.5.0 0.0.1.255 any eq 443
   permit udp 10.0.5.0 0.0.1.255 any eq 53
   permit tcp 10.0.5.0 0.0.1.255 10.0.9.0 0.0.1.255 eq 445
   permit tcp 10.0.5.0 0.0.1.255 10.0.9.0 0.0.1.255 eq 631
   permit ip 10.0.5.0 0.0.1.255 10.0.9.0 0.0.1.255
   deny ip any any
exit
interface vlan 30
   ip access-group ACL_VLAN_DESIGN in
exit

# VLAN 4: Logistique (10.0.7.0/23)
ip access-list extended ACL_VLAN_LOGISTIQUE
   permit tcp 10.0.7.0 0.0.1.255 any eq 80
   permit tcp 10.0.7.0 0.0.1.255 any eq 443
   permit udp 10.0.7.0 0.0.1.255 any eq 53
   permit tcp 10.0.7.0 0.0.1.255 10.0.9.0 0.0.1.255 eq 445
   permit tcp 10.0.7.0 0.0.1.255 10.0.9.0 0.0.1.255 eq 631
   permit ip 10.0.7.0 0.0.1.255 10.0.9.0 0.0.1.255
   deny ip any any
exit
interface vlan 40
   ip access-group ACL_VLAN_LOGISTIQUE in
exit

# VLAN 5: Imprimantes (10.0.9.0/23)
ip access-list extended ACL_VLAN_IMPRIMANTES
   permit tcp 10.0.1.0 0.0.1.255 10.0.9.0 0.0.1.255 eq 445
   permit tcp 10.0.1.0 0.0.1.255 10.0.9.0 0.0.1.255 eq 631
   permit tcp 10.0.5.0 0.0.1.255 10.0.9.0 0.0.1.255 eq 445
   permit tcp 10.0.5.0 0.0.1.255 10.0.9.0 0.0.1.255 eq 631
   permit tcp 10.0.7.0 0.0.1.255 10.0.9.0 0.0.1.255 eq 445
   permit tcp 10.0.7.0 0.0.1.255 10.0.9.0 0.0.1.255 eq 631
   deny ip any any
exit
interface vlan 50
   ip access-group ACL_VLAN_IMPRIMANTES in
exit

# VLAN 6: Direction (10.0.11.0/23)
ip access-list extended ACL_VLAN_DIRECTION
   permit ip 10.0.11.0 0.0.1.255 10.0.1.0 0.0.1.255
   permit ip 10.0.11.0 0.0.1.255 10.0.13.0 0.0.1.255
   permit ip 10.0.11.0 0.0.1.255 10.0.19.0 0.0.1.255
   permit ip 10.0.11.0 0.0.1.255 10.0.9.0 0.0.1.255
   permit ip any any
   deny ip any any
exit
interface vlan 60
   ip access-group ACL_VLAN_DIRECTION in
exit

# VLAN 7: DSI (10.0.13.0/23)
ip access-list extended ACL_VLAN_DSI
   permit tcp 10.0.13.0 0.0.1.255 any eq 80         
   permit tcp 10.0.13.0 0.0.1.255 any eq 443       
   permit udp 10.0.13.0 0.0.1.255 any eq 53         
   permit tcp 10.0.13.0 0.0.1.255 any eq 445    
   permit tcp 10.0.13.0 0.0.1.255 any eq 631    
   permit tcp 10.0.13.0 0.0.1.255 any eq 3389      
   permit tcp 10.0.13.0 0.0.1.255 any eq 22     
   permit udp 10.0.13.0 0.0.1.255 any eq 161      
   permit udp 10.0.13.0 0.0.1.255 any eq 514        
   permit icmp 10.0.13.0 0.0.1.255 any             
   permit tcp 10.0.13.0 0.0.1.255 any eq 389        
   permit udp 10.0.13.0 0.0.1.255 any eq 1812        
   permit udp 10.0.13.0 0.0.1.255 any eq 123      
   permit udp 10.0.13.0 0.0.1.255 any eq 554         
   permit tcp 10.0.13.0 0.0.1.255 any eq 502      
   permit ip 10.0.13.0 0.0.1.255 any
   permit ip 10.0.13.0 0.0.1.255 10.0.9.0 0.0.1.255           
exit

interface vlan 70
   ip access-group ACL_VLAN_DSI in
exit


# VLAN 8: R&D (10.0.15.0/23)
ip access-list extended ACL_VLAN_R&D
   permit tcp 10.0.15.0 0.0.1.255 any eq 80
   permit tcp 10.0.15.0 0.0.1.255 any eq 443
   permit udp 10.0.15.0 0.0.1.255 any eq 53
   permit tcp 10.0.15.0 0.0.1.255 any eq 22
   permit ip 10.0.15.0 0.0.1.255 10.0.9.0 0.0.1.255
   deny ip any any
exit
interface vlan 80
   ip access-group ACL_VLAN_R&D in
exit

#VLAN 9: DEV (10.0.17.0/23)
ip access-list extended ACL_VLAN_DEV
   permit tcp 10.0.17.0 0.0.1.255 any eq 80
   permit tcp 10.0.17.0 0.0.1.255 any eq 443
   permit udp 10.0.17.0 0.0.1.255 any eq 53
   permit tcp 10.0.17.0 0.0.1.255 any eq 445
   permit tcp 10.0.17.0 0.0.1.255 any eq 631
   permit tcp 10.0.17.0 0.0.1.255 any eq 3389
   permit tcp 10.0.17.0 0.0.1.255 any eq 22
   permit udp 10.0.17.0 0.0.1.255 any eq 161
   permit udp 10.0.17.0 0.0.1.255 any eq 514
   permit icmp 10.0.17.0 0.0.1.255 any
   permit tcp 10.0.17.0 0.0.1.255 any eq 389
   permit udp 10.0.17.0 0.0.1.255 any eq 1812
   permit udp 10.0.17.0 0.0.1.255 any eq 123
   permit udp 10.0.17.0 0.0.1.255 any eq 554
   permit tcp 10.0.17.0 0.0.1.255 any eq 502
   permit ip 10.0.17.0 0.0.1.255 10.0.9.0 0.0.1.255
   permit ip 10.0.17.0 0.0.1.255 any
   deny ip any any
exit
interface vlan 90
   ip access-group ACL_VLAN_DEV in
exit

# VLAN 10: Data (10.0.19.0/23)
ip access-list extended ACL_VLAN_DATA
   permit ip 10.0.19.0 0.0.1.255 10.0.13.0 0.0.1.255
   permit ip 10.0.19.0 0.0.1.255 10.0.15.0 0.0.1.255
   permit ip 10.0.19.0 0.0.1.255 10.0.9.0 0.0.1.255
   permit ip any any
   deny ip any any
exit
interface vlan 100
   ip access-group ACL_VLAN_DATA in
exit

# VLAN 11: Conception (10.0.21.0/23)
ip access-list extended ACL_VLAN_CONCEPTION
   permit tcp 10.0.21.0 0.0.1.255 any eq 80
   permit tcp 10.0.21.0 0.0.1.255 any eq 443
   permit udp 10.0.21.0 0.0.1.255 any eq 53
   permit tcp 10.0.21.0 0.0.1.255 any eq 22
   permit ip 10.0.21.0 0.0.1.255 10.0.9.0 0.0.1.255
   deny ip any any
exit
interface vlan 110
   ip access-group ACL_VLAN_CONCEPTION in
exit

# VLAN 12: Invités Wi-Fi (10.0.23.0/25)
ip access-list extended ACL_VLAN_INVITES
   permit tcp 10.0.23.0 0.0.0.127 any eq 80
   permit tcp 10.0.23.0 0.0.0.127 any eq 443
   permit udp 10.0.23.0 0.0.0.127 any eq 53
   deny ip any any
exit
interface vlan 120
   ip access-group ACL_VLAN_INVITES in
exit

# VLAN 13: Contrôle d'accès (10.0.25.0/25)
ip access-list extended ACL_VLAN_CONTROLE_ACCES
   permit tcp 10.0.25.0 0.0.0.127 any eq 80
   permit tcp 10.0.25.0 0.0.0.127 any eq 443
   permit udp 10.0.25.0 0.0.0.127 any eq 53
   deny ip any any
exit
interface vlan 130
   ip access-group ACL_VLAN_CONTROLE_ACCES in
exit

# VLAN 14: Sécurité Incendie (10.0.26.0/22)
ip access-list extended ACL_VLAN_SECURITE_INCENDIE
   permit udp 10.0.26.0 0.0.3.255 any eq 514 
   permit tcp 10.0.26.0 0.0.3.255 any eq 443
   deny ip any any
exit
interface vlan 140
   ip access-group ACL_VLAN_SECURITE_INCENDIE in
exit

# VLAN 15: Vidéosurveillance (10.0.36.0/23)
ip access-list extended ACL_VLAN_VIDEOSURVEILLANCE
   permit tcp 10.0.36.0 0.0.1.255 any eq 443  
   permit udp 10.0.36.0 0.0.1.255 any eq 554  
   permit udp 10.0.36.0 0.0.1.255 any eq 514  
   deny ip any any
exit
interface vlan 190
   ip access-group ACL_VLAN_VIDEOSURVEILLANCE in
exit

# VLAN 16: Système Audio (10.0.30.0/27)
ip access-list extended ACL_VLAN_SYSTEME_AUDIO
   permit tcp 10.0.30.0 0.0.0.31 any eq 443   
   permit udp 10.0.30.0 0.0.0.31 any eq 514  
   deny ip any any
exit
interface vlan 150
   ip access-group ACL_VLAN_SYSTEME_AUDIO in
exit

# VLAN 17: Gestion Bâtiment (10.0.32.0/23)
ip access-list extended ACL_VLAN_GESTION_BATIMENT
   permit tcp 10.0.32.0 0.0.1.255 any eq 443       
   permit udp 10.0.32.0 0.0.1.255 any eq 161   
   permit udp 10.0.32.0 0.0.1.255 any eq 123  
   permit tcp 10.0.32.0 0.0.1.255 any eq 502  
   permit tcp 10.0.32.0 0.0.1.255 any eq 47808 
   permit ip 10.0.32.0 0.0.1.255 10.0.9.0 0.0.1.255
   permit ip 10.0.32.0 0.0.1.255 10.0.25.0 0.0.0.127
   permit ip 10.0.32.0 0.0.1.255 10.0.26.0 0.0.3.255
   permit ip 10.0.32.0 0.0.1.255 10.0.36.0 0.0.1.255
   permit ip 10.0.32.0 0.0.1.255 10.0.30.0 0.0.0.31
   deny ip any any
exit


# VLAN 18: VIDÉ (10.0.38.0/23)
ip access-list extended ACL_VLAN_VIDE_2
   deny ip any any
exit
interface vlan 200
   ip access-group ACL_VLAN_VIDE_2 in
exit

# VLAN 19: VIDÉ (10.0.40.0/23)
ip access-list extended ACL_VLAN_VIDE_3
   deny ip any any
exit
interface vlan 210
   ip access-group ACL_VLAN_VIDE_3 in
exit

# VLAN 20: VIDÉ (10.0.42.0/23)
ip access-list extended ACL_VLAN_VIDE_4
   deny ip any any
exit
interface vlan 220
   ip access-group ACL_VLAN_VIDE_4 in
exit

# VLAN 21: VIDÉ (10.0.44.0/23)
ip access-list extended ACL_VLAN_VIDE_5
   deny ip any any
exit
interface vlan 230
   ip access-group ACL_VLAN_VIDE_5 in
exit

write memory
